# CretoAI Phase 7 Helm Chart Values
# Enhanced Consensus with Multi-Cloud Support

global:
  imageRegistry: "cretoai"
  imagePullPolicy: IfNotPresent
  storageClass: "fast-ssd"

  # Phase 7 feature flags
  features:
    weightedVoting: true
    adaptiveQuorum: true
    multiSignature: true
    forkDetection: true
    multiCloudStorage: true
    complianceMonitoring: true
    reputationSystem: true

# Consensus service configuration
consensus:
  enabled: true
  replicaCount: 7
  image:
    repository: cretoai/consensus
    tag: v1.7.0
    pullPolicy: IfNotPresent

  # Resource limits for 1M agents
  resources:
    requests:
      memory: "8Gi"
      cpu: "4000m"
      ephemeralStorage: "10Gi"
    limits:
      memory: "16Gi"
      cpu: "8000m"
      ephemeralStorage: "20Gi"

  # Storage configuration
  persistence:
    enabled: true
    size: 500Gi
    storageClass: fast-ssd
    accessModes:
      - ReadWriteOnce

  # Weighted voting configuration
  weightedVoting:
    enabled: true
    baseWeight: 1.0
    reputationMultiplier: 2.0
    minWeight: 0.1
    maxWeight: 5.0

  # Adaptive quorum configuration
  adaptiveQuorum:
    enabled: true
    baseThreshold: 0.67
    minThreshold: 0.51
    maxThreshold: 0.82
    adjustmentRate: 0.01
    highTrustThreshold: 0.8
    lowTrustThreshold: 0.5

  # Multi-signature configuration
  multiSignature:
    enabled: true
    aggregationMethod: "bls"
    verificationBatchSize: 100
    signatureThreshold: 0.67

  # Fork detection configuration
  forkDetection:
    enabled: true
    detectionWindow: 300
    maxDivergence: 10
    autoRollback: true
    alertThreshold: 5

  # Service configuration
  service:
    type: LoadBalancer
    port: 443
    targetPort: 8080
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-internal: "true"

  # TLS configuration
  tls:
    enabled: true
    secretName: cretoai-tls

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 8080
      scheme: HTTPS
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /ready
      port: 8080
      scheme: HTTPS
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 2

# Reputation system configuration
reputation:
  enabled: true
  replicaCount: 3
  image:
    repository: cretoai/reputation
    tag: v1.7.0

  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  persistence:
    enabled: true
    size: 200Gi
    storageClass: fast-ssd

  # Reputation scoring parameters
  scoring:
    decayRate: 0.95
    decayInterval: 86400
    minScore: 0.3
    maxScore: 1.0
    initialScore: 0.7
    successfulVoteReward: 0.05
    failedVotePenalty: -0.1
    byzantineBehaviorPenalty: -0.5

  service:
    type: ClusterIP
    port: 8081

# Compliance monitoring configuration
compliance:
  enabled: true
  replicaCount: 2
  image:
    repository: cretoai/compliance
    tag: v1.7.0

  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  # Compliance standards
  standards:
    - cmmc-level2
    - fedramp-moderate

  # Audit logging
  auditLogging:
    enabled: true
    retentionDays: 2555
    realTimeMonitoring: true
    alertOnViolation: true
    encryptionAtRest: true

  # Compliance dashboard
  dashboard:
    enabled: true
    ingress:
      enabled: true
      host: compliance.cretoai.io
      tls:
        enabled: true
        secretName: compliance-dashboard-tls

  service:
    type: ClusterIP
    port: 8082

# Multi-cloud storage configuration
storage:
  multiCloud:
    enabled: true

    # Primary storage (AWS S3)
    primary:
      provider: "aws-s3"
      bucket: "cretoai-consensus-prod"
      region: "us-gov-west-1"
      endpoint: ""
      accessKeySecret: "aws-s3-credentials"
      encryption:
        enabled: true
        kmsKeyId: "arn:aws:kms:us-gov-west-1:123456789:key/abc123"

    # Secondary storage (Azure Blob)
    secondary:
      provider: "azure-blob"
      container: "cretoai-consensus-prod"
      storageAccount: "cretoaprod"
      endpoint: "https://cretoaprod.blob.core.usgovcloudapi.net"
      credentialsSecret: "azure-blob-credentials"
      encryption:
        enabled: true

    # Replication settings
    replication:
      enabled: true
      delay: 60
      consistencyCheckInterval: 3600
      conflictResolution: "last-write-wins"

  # Local RocksDB configuration
  rocksdb:
    maxOpenFiles: 10000
    writeBufferSize: 67108864
    maxWriteBufferNumber: 3
    compression: "snappy"
    blockCacheSize: 536870912

# Performance configuration
performance:
  maxAgents: 1000000
  maxConcurrentVotes: 10000
  voteTimeoutMs: 5000
  batchSize: 1000
  workerThreads: 8

# Monitoring configuration
monitoring:
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 30s

  grafana:
    enabled: true
    adminUser: admin
    adminPassword: changeme
    ingress:
      enabled: true
      host: monitoring.cretoai.io

  loki:
    enabled: true

  tracing:
    enabled: true
    jaeger:
      enabled: true

# Security configuration
security:
  authentication: "mtls"
  authorization: "rbac"
  rateLimiting:
    enabled: true
    requestsPerSecond: 1000
  ddosProtection:
    enabled: true

  # Network policies
  networkPolicies:
    enabled: true
    policyTypes:
      - Ingress
      - Egress

  # Pod security
  podSecurityPolicy:
    enabled: true
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
    seccompProfile:
      type: RuntimeDefault

# High availability configuration
highAvailability:
  enabled: true
  leaderElection:
    enabled: true
    leaseDuration: 15s
    renewDeadline: 10s
    retryPeriod: 2s

  # Anti-affinity rules
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - cretoai
          topologyKey: "kubernetes.io/hostname"
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - cretoai
            topologyKey: "topology.kubernetes.io/zone"

  # Topology spread constraints
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app: cretoai
    - maxSkew: 2
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: ScheduleAnyway
      labelSelector:
        matchLabels:
          app: cretoai

# Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"
  retention: 30
  s3:
    bucket: "cretoai-backups"
    region: "us-gov-west-1"
    prefix: "phase7/"

# Autoscaling configuration
autoscaling:
  enabled: true
  minReplicas: 7
  maxReplicas: 21
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 2
          periodSeconds: 60

# Disaster recovery configuration
disasterRecovery:
  enabled: true
  multiRegion:
    enabled: true
    regions:
      - us-gov-west-1
      - us-gov-east-1
  backup:
    enabled: true
    schedule: "0 */6 * * *"
  replication:
    enabled: true
    async: true
    syncInterval: 60

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - host: api.cretoai.io
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - api.cretoai.io
      secretName: api-tls

# Service mesh configuration
serviceMesh:
  enabled: true
  provider: "istio"
  mtls:
    enabled: true
  trafficPolicy:
    loadBalancer:
      simple: LEAST_REQUEST
    connectionPool:
      tcp:
        maxConnections: 1000
      http:
        http1MaxPendingRequests: 1000
        http2MaxRequests: 1000
