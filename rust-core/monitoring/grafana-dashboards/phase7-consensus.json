{
  "dashboard": {
    "title": "CretoAI Phase 7 - Enhanced Consensus Monitoring",
    "uid": "cretoai-phase7-consensus",
    "version": 1,
    "timezone": "browser",
    "schemaVersion": 30,
    "refresh": "10s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "tags": ["cretoai", "phase7", "consensus"],
    "panels": [
      {
        "id": 1,
        "title": "Weighted Vote Distribution",
        "type": "graph",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(cretoai_weighted_votes_bucket[5m])) by (le, validator))",
            "legendFormat": "p95 - {{validator}}",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.50, sum(rate(cretoai_weighted_votes_bucket[5m])) by (le, validator))",
            "legendFormat": "p50 - {{validator}}",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 2
          }
        }
      },
      {
        "id": 2,
        "title": "Adaptive Quorum Threshold",
        "type": "graph",
        "gridPos": {"x": 12, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "cretoai_adaptive_quorum_threshold",
            "legendFormat": "Current Threshold",
            "refId": "A"
          },
          {
            "expr": "cretoai_adaptive_quorum_base_threshold",
            "legendFormat": "Base Threshold (0.67)",
            "refId": "B"
          },
          {
            "expr": "cretoai_adaptive_quorum_min_threshold",
            "legendFormat": "Min Threshold (0.51)",
            "refId": "C"
          },
          {
            "expr": "cretoai_adaptive_quorum_max_threshold",
            "legendFormat": "Max Threshold (0.82)",
            "refId": "D"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "min": 0.5,
            "max": 0.85,
            "decimals": 3
          }
        }
      },
      {
        "id": 3,
        "title": "Multi-Signature Aggregation Rate",
        "type": "stat",
        "gridPos": {"x": 0, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "rate(cretoai_multisig_aggregations_total[5m])",
            "legendFormat": "Aggregations/sec",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 10, "color": "yellow"},
                {"value": 50, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Fork Detection Events",
        "type": "stat",
        "gridPos": {"x": 6, "y": 8, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(increase(cretoai_fork_detections_total[1h]))",
            "legendFormat": "Forks Detected (1h)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 3, "color": "yellow"},
                {"value": 5, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Reputation Score Distribution",
        "type": "histogram",
        "gridPos": {"x": 12, "y": 8, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "cretoai_reputation_score",
            "legendFormat": "{{validator_id}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "min": 0,
            "max": 1,
            "decimals": 3
          }
        },
        "options": {
          "bucketSize": 0.1
        }
      },
      {
        "id": 6,
        "title": "Consensus Latency (p50, p95, p99)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.99, sum(rate(cretoai_consensus_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "p99",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, sum(rate(cretoai_consensus_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "p95",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.50, sum(rate(cretoai_consensus_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "p50",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "decimals": 3
          }
        }
      },
      {
        "id": 7,
        "title": "Active Agents",
        "type": "stat",
        "gridPos": {"x": 12, "y": 16, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "cretoai_active_agents",
            "legendFormat": "Active Agents",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 100000, "color": "yellow"},
                {"value": 500000, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 8,
        "title": "Voting Success Rate",
        "type": "gauge",
        "gridPos": {"x": 18, "y": 16, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(rate(cretoai_votes_successful_total[5m])) / sum(rate(cretoai_votes_total[5m])) * 100",
            "legendFormat": "Success Rate",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 95, "color": "yellow"},
                {"value": 99, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Byzantine Fault Detection",
        "type": "graph",
        "gridPos": {"x": 0, "y": 24, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum(rate(cretoai_byzantine_faults_detected_total[5m])) by (fault_type)",
            "legendFormat": "{{fault_type}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops",
            "decimals": 2
          }
        }
      },
      {
        "id": 10,
        "title": "Storage Backend Status",
        "type": "table",
        "gridPos": {"x": 12, "y": 24, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "cretoai_storage_backend_status",
            "legendFormat": "",
            "refId": "A",
            "format": "table",
            "instant": true
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "backend": "Storage Backend",
                "status": "Status",
                "latency_ms": "Latency (ms)"
              }
            }
          }
        ]
      },
      {
        "id": 11,
        "title": "Memory Usage by Component",
        "type": "graph",
        "gridPos": {"x": 0, "y": 32, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "container_memory_usage_bytes{namespace=\"cretoai-system\", pod=~\"cretoai-consensus-.*\"} / 1024 / 1024 / 1024",
            "legendFormat": "{{container}} - {{pod}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "gbytes",
            "decimals": 2
          }
        }
      },
      {
        "id": 12,
        "title": "CPU Usage by Component",
        "type": "graph",
        "gridPos": {"x": 12, "y": 32, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "rate(container_cpu_usage_seconds_total{namespace=\"cretoai-system\", pod=~\"cretoai-consensus-.*\"}[5m]) * 100",
            "legendFormat": "{{container}} - {{pod}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "decimals": 2
          }
        }
      },
      {
        "id": 13,
        "title": "Network I/O (Gossip Protocol)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 40, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "rate(cretoai_gossip_bytes_sent_total[5m])",
            "legendFormat": "Bytes Sent",
            "refId": "A"
          },
          {
            "expr": "rate(cretoai_gossip_bytes_received_total[5m])",
            "legendFormat": "Bytes Received",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "Bps",
            "decimals": 2
          }
        }
      },
      {
        "id": 14,
        "title": "Disk I/O Operations",
        "type": "graph",
        "gridPos": {"x": 12, "y": 40, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "rate(cretoai_rocksdb_read_ops_total[5m])",
            "legendFormat": "Read Ops/sec",
            "refId": "A"
          },
          {
            "expr": "rate(cretoai_rocksdb_write_ops_total[5m])",
            "legendFormat": "Write Ops/sec",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ops",
            "decimals": 2
          }
        }
      },
      {
        "id": 15,
        "title": "Agent Capacity Utilization",
        "type": "gauge",
        "gridPos": {"x": 0, "y": 48, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "(cretoai_active_agents / cretoai_max_agents) * 100",
            "legendFormat": "Capacity Utilization",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 80, "color": "yellow"},
                {"value": 90, "color": "red"}
              ]
            }
          }
        },
        "pluginVersion": "10.2.0"
      },
      {
        "id": 16,
        "title": "System Health Score",
        "type": "stat",
        "gridPos": {"x": 12, "y": 48, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "(sum(cretoai_consensus_healthy) + sum(cretoai_reputation_healthy) + sum(cretoai_compliance_healthy)) / 3 * 100",
            "legendFormat": "Overall Health",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "decimals": 1,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 90, "color": "yellow"},
                {"value": 98, "color": "green"}
              ]
            }
          }
        }
      }
    ]
  }
}
