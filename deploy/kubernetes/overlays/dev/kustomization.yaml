apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: authz-engine-dev

namespace: authz-dev

bases:
  - ../../base

namePrefix: dev-

commonLabels:
  environment: development

commonAnnotations:
  environment: development
  owner: development-team

# Development-specific configurations
replicas:
  - name: authz-engine
    count: 1

images:
  - name: authz-engine
    newTag: latest

# ConfigMap patches for development
configMapGenerator:
  - name: authz-config
    behavior: merge
    literals:
      - log-level=debug
      - log-format=console
      - cache-enabled=false
      - workers=4

# HPA patches - disable for development
patches:
  - target:
      kind: HorizontalPodAutoscaler
      name: authz-engine-hpa
    patch: |-
      - op: replace
        path: /spec/minReplicas
        value: 1
      - op: replace
        path: /spec/maxReplicas
        value: 1

# Resource limits for development (lower than production)
resources:
  - ../../namespace.yaml
  - ../../deployment.yaml
  - ../../service.yaml
  - ../../configmap.yaml
  - ../../pdb.yaml

# Development-specific configurations
vars:
  - name: ENVIRONMENT
    literal: development
  - name: NAMESPACE
    objref:
      kind: Namespace
      name: authz-dev
    fieldref:
      fieldpath: metadata.name
