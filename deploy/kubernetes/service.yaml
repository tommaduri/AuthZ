apiVersion: v1
kind: Service
metadata:
  name: authz-grpc
  namespace: authz-system
  labels:
    app: authz-engine
    service: grpc
  annotations:
    description: "gRPC service for authorization engine"
spec:
  type: ClusterIP
  selector:
    app: authz-engine
  ports:
    - name: grpc
      port: 50051
      targetPort: grpc
      protocol: TCP
  sessionAffinity: None

---
apiVersion: v1
kind: Service
metadata:
  name: authz-http
  namespace: authz-system
  labels:
    app: authz-engine
    service: http
  annotations:
    description: "HTTP service for health checks and metrics"
spec:
  type: ClusterIP
  selector:
    app: authz-engine
  ports:
    - name: http
      port: 8080
      targetPort: http
      protocol: TCP
  sessionAffinity: None

---
apiVersion: v1
kind: Service
metadata:
  name: authz-api
  namespace: authz-system
  labels:
    app: authz-engine
    service: api
  annotations:
    description: "REST API service"
spec:
  type: ClusterIP
  selector:
    app: authz-engine
  ports:
    - name: api
      port: 3592
      targetPort: http
      protocol: TCP
  sessionAffinity: None

---
apiVersion: v1
kind: Service
metadata:
  name: authz-headless
  namespace: authz-system
  labels:
    app: authz-engine
    service: headless
  annotations:
    description: "Headless service for inter-pod communication and DNS"
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app: authz-engine
  ports:
    - name: grpc
      port: 50051
      targetPort: grpc
      protocol: TCP
    - name: http
      port: 8080
      targetPort: http
      protocol: TCP
  publishNotReadyAddresses: true

---
apiVersion: v1
kind: Endpoints
metadata:
  name: authz-postgres
  namespace: authz-system
subsets:
  - addresses:
      - ip: 10.0.0.5
    ports:
      - name: postgres
        port: 5432

---
apiVersion: v1
kind: Service
metadata:
  name: authz-postgres
  namespace: authz-system
  labels:
    app: postgres
spec:
  type: ClusterIP
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP

---
apiVersion: v1
kind: Endpoints
metadata:
  name: authz-redis
  namespace: authz-system
subsets:
  - addresses:
      - ip: 10.0.0.6
    ports:
      - name: redis
        port: 6379

---
apiVersion: v1
kind: Service
metadata:
  name: authz-redis
  namespace: authz-system
  labels:
    app: redis
spec:
  type: ClusterIP
  ports:
    - name: redis
      port: 6379
      targetPort: 6379
      protocol: TCP
